# (APPENDIX) Appendix {-} 

# Appendix A
## Authors Guidelines
We have decided to adapt the tidyverse style guide. Detailed content can be found here.  
  
[tidyverse style guide][1]
  
Before committing code to the git repository, it should be styled using the styler package.

Primary points are outlined below:
- Use underscores (snake_case) to separate words in both variable and file names. 
- Use periods to separate words in function names
````
File Names:
chapter_1.Rmd
---
Variable Names:
observed_data
````
- When submitting a description of a new model use the template provided in Appendix B. However, if extenuating circumstances make the template in Appendix B untenable for a model, describe the reason for departure in the git commit message.
- Variables should be named with nouns, functions should be named with verbs
- Use dots to separate words in function names
````
simulate.code <- function(X) {
}
````
- Label function arguments
- Spaces after commas not before
- Do not pad parentheses with spaces
- Pad operators with space
````
foo == bar
foo <- bar
foo + bar
foo * bar
````
[1]: https://style.tidyverse.org/

# Appendix B
## Model Template

````
## Model Name 
Model description

### Algebra

Algebraic model description in latex

### Simulation 
```{r }r ''`

simulated_data <- 1

```  
### Models {.tabset}

::: {.tab}
<button class="tablinks" onclick="unrolltab(event,'JAGS')">JAGS</button>
<button class="tablinks" onclick="unrolltab(event,'NIMBLE')">NIMBLE</button>
<button class="tablinks" onclick="unrolltab(event, 'Stan')">Stan</button>
<button class="tablinks" onclick="unrolltab(event, 'Greta')">Greta</button>
::: {#JAGS .tabcontent}
#### JAGS model fit {-}
```{r ,eval = FALSE,warning=FALSE,message=FALSE,error=FALSE, results='hide'}r ''`
library(knitr)
library(R2jags)
data <- list(

)
model_string <- textConnection(
  "
  model {
  
  # Likelihood
 
  # Priors


  # Derived values

  }
"
)
parameters <- c( )
set_initial_value <- function() {
  list( 
    
  )
}
ni <- 10000 ; nt <- 1 ; nb <- 5000 ; nc <- 3
model <- jags(data, set_initial_value, parameters, model_string, n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb)
```
:::
::: {#NIMBLE .tabcontent}
#### NIMBLE model fit {-}
```{r ,eval = FALSE,warning=FALSE,message=FALSE,error=FALSE, results='hide'}
library(nimble)
n_data <- list(

)
n_constants <- list(

)
Nimble_Code <- nimbleCode({
  # Likelihood
  
  # Priors
  
  # Derived values

})

n_params <- c( )
n_inits <- list( 
  
)
Nimble_Model <- nimbleModel(
  code = Nimble_Code,
  constants = n_constants,
  data = n_data,
  inits = n_inits
)
MCMC_Model <- configureMCMC(Nimble_Model, monitors = n_params, print = T, enableWAIC = F)
Model1_MCMC <- buildMCMC(MCMC_Model)
Comp_Model <- compileNimble( Nimble_Model, showCompilerOutput = TRUE )
Comp_Model <- compileNimble(Model1_MCMC, project = Nimble_Model)

niter=10000
Model_samples <- runMCMC(Comp_Model, niter = niter, nburnin=niter/2,nchains=3,summary = TRUE)
mcmc_combo(Model_samples$samples, pars = c("N", "p"))
round(Model_samples$summary$all.chains,2)

```
:::
::: {#Stan .tabcontent}
#### Stan  {-}
```{r ,eval = FALSE,warning=FALSE,message=FALSE,error=FALSE, results='hide'}r ''`
library(knitr)
library(rstan)

data <- list(

)

stan_model <- "
data {

}

parameters {

}

model {  

}

generated quantities {

}
"
nc <- 4

stan.samples <- stan(model_code = stan_model, data = data, iter = 10000, chains = nc, cores = nc)
```

:::
::: {#Greta .tabcontent}
#### Greta  {-}
```{r ,eval = FALSE,warning=FALSE,message=FALSE,error=FALSE, results='hide'}r ''`
library(greta)
# priors

# likelihood

# derived parameter

# defining the model
m <- model() #objects to sample

# sampling
draws <- greta::mcmc(m, n_samples = 1000)
```
```{r}r ''`
plot(m)
```
:::
:::

### Comparison
```{r , echo=FALSE, warning=FALSE}r```
#round(model$BUGSoutput$summary[c(1,3),c(1,2,3,7)],2) #jags 
#round(summary(stan.samples)$summary[c(2,1),c(1,3,4,8)],2) #stan 
#summary(draws) #greta 
#https://gt.rstudio.com/articles/intro-creating-gt-tables.html

library(gt)
library(tidyverse)
results_df <- data.frame(
              Sampler=c(),
              Parameter=c(),
              Mean=c(),
              SD=c(),
              LCL=c(),
              UCL=c()
              )

results_df %>%
  dplyr::select(-Sampler,-Parameter) %>%
  gt() %>%
  tab_row_group(
    group = "p",
    rows = 5:8
  ) %>%
  tab_row_group(
    group = "N",
    rows = 1:4
  ) %>%
  tab_header(
    title = "",
    subtitle = ""
  )
```
````