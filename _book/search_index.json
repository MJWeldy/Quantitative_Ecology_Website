[["index.html", "Quantitative Ecology Modelling applications in population ecology Chapter 1 Prerequisites", " Quantitative Ecology Modelling applications in population ecology Matt Weldy 2021-02-23 Chapter 1 Prerequisites This is a work in progress. The scope of this work is to demonstrate the fit of well known ecological models using a variety of tools. Our aim is to provide brief model descriptions, primary citations, and a simple simulation and model fit. Contributions to this web page are welcome, and can be made through the books github repository. The website is hosted through netlify, which offers continuous integration with the books git repository. Commit changes to the repository after using the bookdown and changes will populate to the page. Please try to structure indivudal model fits using the template outlined in Appendix B. bookdown::render_book(&quot;index.Rmd&quot;, &quot;bookdown::gitbook&quot;) "],["intro.html", "Chapter 2 Introduction", " Chapter 2 Introduction You can label chapter and section titles using {#label} after them, e.g., we can reference Chapter 2. If you do not manually label them, there will be automatic labels anyway, e.g., Chapter ??. Figures and tables with captions will be placed in figure and table environments, respectively. par(mar = c(4, 4, .1, .1)) plot(pressure, type = &#39;b&#39;, pch = 19) Figure 2.1: Here is a nice figure! Reference a figure by its code chunk label with the fig: prefix, e.g., see Figure 2.1. Similarly, you can reference tables generated from knitr::kable(), e.g., see Table 2.1. knitr::kable( head(iris, 20), caption = &#39;Here is a nice table!&#39;, booktabs = TRUE ) Table 2.1: Here is a nice table! Sepal.Length Sepal.Width Petal.Length Petal.Width Species 5.1 3.5 1.4 0.2 setosa 4.9 3.0 1.4 0.2 setosa 4.7 3.2 1.3 0.2 setosa 4.6 3.1 1.5 0.2 setosa 5.0 3.6 1.4 0.2 setosa 5.4 3.9 1.7 0.4 setosa 4.6 3.4 1.4 0.3 setosa 5.0 3.4 1.5 0.2 setosa 4.4 2.9 1.4 0.2 setosa 4.9 3.1 1.5 0.1 setosa 5.4 3.7 1.5 0.2 setosa 4.8 3.4 1.6 0.2 setosa 4.8 3.0 1.4 0.1 setosa 4.3 3.0 1.1 0.1 setosa 5.8 4.0 1.2 0.2 setosa 5.7 4.4 1.5 0.4 setosa 5.4 3.9 1.3 0.4 setosa 5.1 3.5 1.4 0.3 setosa 5.7 3.8 1.7 0.3 setosa 5.1 3.8 1.5 0.3 setosa You can write citations, too. For example, we are using the bookdown package (Xie 2020) in this sample book, which was built on top of R Markdown and knitr (Xie 2015). "],["abundance.html", "Chapter 3 Abundance 3.1 Lincoln-Peterson 3.2 Full Likelihood 3.3 Conditional Likelihood 3.4 Data Augmentation 3.5 N-Mixture Model 3.6 Spatial Capture-Recapture", " Chapter 3 Abundance Here is a review of existing methods. 3.1 Lincoln-Peterson 3.2 Full Likelihood 3.3 Conditional Likelihood The conditional likelihood abundance estimator proposed by Huggins (1989) and Alho (1990), which was further extended in Huggins (1991), is an extension to previous abundance estimators to account for heterogeneous capture probabilities (\\(p\\)). The model estimates individual capture probabilities and abundance conditional on captured individuals. 3.3.1 Algebra \\[ \\mathcal{L} = \\prod_{i=1}^n \\prod_{t=1}^t p_{i,t}^{z_{i,t}}(1-p_{i,t})^{1-z_{i,t}} \\] where, \\(z_{i,t}\\) takes the value of 1 if individual \\(i\\) has been captured before occasion \\(t\\) and 0 otherwise. Thus the capture history \\(y_{i,t}\\) is used to estimate the capture probability of individual \\(i\\) as a Bernoulli trial, \\[y_{i,t} \\sim Bernoulli(p_{i,t}) \\] and abundance \\(\\hat{N}\\) is derived condtional on the count of known individuals (\\(C\\)), sometimes referred to the minimum number of known alive (\\(MNKA\\)). \\[\\hat{N} = \\frac{C}{1-\\prod^{t}(1-p_t)}\\] Variation in detection probability can be modeled using linear logistic models or other variations used to estimate probabilities 0-1. 3.3.2 Simulation N &lt;- 150 #True population size n_occ &lt;- 4 #Number of trapping occasions p &lt;- 0.50 #Probability of first detection true_detections &lt;- array(NA, dim=c(N,n_occ)) for (t in 1:n_occ){ true_detections[,t] &lt;- rbinom(n=N,size=1,prob=p) } observed &lt;- true_detections[apply(true_detections,1,max) == 1,] MNKA &lt;- nrow(observed) print( paste0(&quot;Number ever detected: &quot;, MNKA,sep = &quot; &quot;) ) #number ever detected ## [1] &quot;Number ever detected: 138 &quot; 3.3.3 Models JAGS Stan Greta JAGS model fit library(knitr) library(R2jags) data &lt;- list( y=observed, nsites=nrow(observed), MNKA=MNKA, n_occ=n_occ ) model_string &lt;- textConnection( &quot; model { # Likelihood for(i in 1:nsites) { # Observation model for(j in 1:4) { y[i, j] ~ dbern(p) } } for(t in 1:4){ p_un[t] &lt;- (1-p) } # Priors p ~ dunif(0, 1) # Uninformative prior # Derived values N &lt;- (MNKA / (1-prod(p_un[]))) }&quot;) parameters &lt;- c(&quot;p&quot;,&quot;N&quot;) inits &lt;- function() { list( ) } ni &lt;- 10000 ; nt &lt;- 1 ; nb &lt;- 5000 ; nc &lt;- 3 model &lt;- jags(data, inits, parameters, model_string, n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb) jags_output &lt;- cbind(Sampler=rep(&#39;jags&#39;,2), round(model$BUGSoutput$summary[c(1,3),c(1,2,3,7)],2)) Stan library(knitr) library(rstan) data &lt;- list( y=observed, nsites=nrow(observed), MNKA=MNKA, n_occ=n_occ ) stan_model &lt;- &quot; data { int&lt;lower=0&gt; MNKA; int&lt;lower=0&gt; nsites; int&lt;lower=0&gt; n_occ; int&lt;lower=0,upper=1&gt; y[MNKA, n_occ]; } parameters { real&lt;lower=0, upper=1&gt; p; } model { for(i in 1:nsites) for(j in 1:4) y[i, j] ~ bernoulli_lpmf(p); } generated quantities { real N = MNKA / (1-(1-p)^4); } &quot; nc &lt;- 4 stan.samples &lt;- stan(model_code = stan_model, data = data, iter = 10000, chains = nc, cores = nc, open_progress=FALSE) stan_output &lt;- cbind(Sampler=rep(&#39;stan&#39;,2,), round(summary(stan.samples)$summary[c(2,1),c(1,3,4,8)],2)) Greta library(greta) capture_vec &lt;- apply(observed, 1, function(x) x[min(which(x &gt; 0)):max(which(x &gt; 0))][-1]) capture_vec &lt;- unlist(capture_vec) length(capture_vec) p_greta &lt;- beta(1, 1) p_greta &lt;- uniform(0, 1) # likelihood distribution(capture_vec) &lt;- bernoulli(p_greta) # derived parameter pstar &lt;- 1-(1-p_greta)*(1-p_greta)*(1-p_greta)*(1-p_greta) N_hat &lt;- MNKA / pstar # defining the model m &lt;- model(p_greta, N_hat,pstar) #plot(m) # sampling draws &lt;- greta::mcmc(m, n_samples = 1000) greta_output &lt;- cbind(Sampler=rep(&#39;greta&#39;,2),round(summary(draws)$statistics[c(2,1),c(1,2)],2),round(summary(draws)$quantiles[c(2,1),c(1,5)],2)) 3.3.4 Comparison results &lt;- rbind(jags_output, stan_output, greta_output) kable(results) Sampler mean sd 2.5% 97.5% N jags 145.13 1.37 142.74 148.12 p jags 0.53 0.02 0.49 0.57 N stan 145.12 1.35 142.78 148.03 p stan 0.53 0.02 0.49 0.57 N_hat greta 138.87 0.41 138.32 139.86 p_greta greta 0.72 0.03 0.66 0.78 3.4 Data Augmentation 3.5 N-Mixture Model 3.6 Spatial Capture-Recapture "],["occupancy.html", "Chapter 4 Occupancy", " Chapter 4 Occupancy We describe our methods in this chapter. "],["survival.html", "Chapter 5 Survival 5.1 Cormack-Jolly-Seber 5.2 Jolly-Seber", " Chapter 5 Survival 5.1 Cormack-Jolly-Seber 5.2 Jolly-Seber "],["appendix-a.html", "A Appendix A A.1 Authors Guidelines", " A Appendix A A.1 Authors Guidelines We have decided to adapt the tidyverse style guide. Detailed content can be found here. tidyverse style guide Before committing code to the git repository, it should be styled using the styler package. Primary points are outlined below: - Use underscores to separate words in both variable and file names. File Names: chapter_1.Rmd --- Variable Names: observed_data When submitting a description of a new model use the template provided in Appendix B. However, if extenuating circumstances make the template in Appendix B untenable for a model, describe the reason for departure in the git commit message. Variables should be named with nouns, functions should be named with verbs Use dots to separate words in function names simulate.code &lt;- function(X) { } Label function arguments Spaces after commas not before Do not pad parentheses with spaces Pad operators with space foo == bar foo &lt;- bar foo + bar foo * bar "],["appendix-b.html", "B Appendix B B.1 Model Template", " B Appendix B B.1 Model Template ## Model Name Model description ### Algebra Algebraic model description in latex ### Simulation ```{r simulation} simulated_data &lt;- 1 ``` ### Models {.tabset} ::: {.tab} &lt;button class=&quot;tablinks&quot; onclick=&quot;unrolltab(event,&#39;JAGS&#39;)&quot;&gt;JAGS&lt;/button&gt; &lt;button class=&quot;tablinks&quot; onclick=&quot;unrolltab(event, &#39;Stan&#39;)&quot;&gt;Stan&lt;/button&gt; &lt;button class=&quot;tablinks&quot; onclick=&quot;unrolltab(event, &#39;Greta&#39;)&quot;&gt;Greta&lt;/button&gt; ::: {#JAGS .tabcontent} #### JAGS model fit {-} ```{r,warning=FALSE,message=FALSE,error=FALSE, results=&#39;hide&#39;,cache = TRUE}r &#39;&#39;` library(knitr) library(R2jags) data &lt;- list( ) model_string &lt;- textConnection( &quot; model { # Likelihood # Priors # Derived values } &quot; ) parameters &lt;- c( ) set_initial_value &lt;- function() { list( ) } ni &lt;- 10000 ; nt &lt;- 1 ; nb &lt;- 5000 ; nc &lt;- 3 model &lt;- jags(data, set_initial_value, parameters, model_string, n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb) ``` ```{r output_jags_table}r &#39;&#39;` library(knitr) kable(round( ,2)) ``` ::: ::: {#Stan .tabcontent} #### Stan {-} ```{r ,warning=FALSE,message=FALSE,error=FALSE, results=&#39;hide&#39;,cache = TRUE}r &#39;&#39;` library(knitr) library(rstan) data &lt;- list( ) stan_model &lt;- &quot; data { } parameters { } model { } generated quantities { } &quot; nc &lt;- 4 stan.samples &lt;- stan(model_code = stan_model, data = data, iter = 10000, chains = nc, cores = nc) ``` ```{r output_stan_table} library(knitr) kable(round( ,2)) ``` ::: ::: {#Greta .tabcontent} #### Greta {-} ```{r}r &#39;&#39;` Greta &lt;- code &lt;- 1 ``` ::: ::: ### Comparison ```{r Comparison} ``` "],["references.html", "References", " References Alho, J. M. 1990. Logistic Regression in CaptureRecapture Models. Biometrics 46 (3): 62335. Huggins, R. M. 1989. On the Statistical Analysis of Capture Experiments. Biometrika 76 (1): 13340. https://doi.org/10.2307/2336377. . 1991. Some Practical Aspects of a Conditional Likelihood Approach to Capture Experiments. Biometrics 47 (2): 72532. https://doi.org/10.2307/2532158. Xie, Yihui. 2015. Dynamic Documents with R and Knitr. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. http://yihui.org/knitr/. . 2020. Bookdown: Authoring Books and Technical Documents with r Markdown. https://github.com/rstudio/bookdown. "]]
